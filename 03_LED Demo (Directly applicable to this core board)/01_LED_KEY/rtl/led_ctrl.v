/***************************************************
*	Module Name		:	led_ctrl		   
*	Engineer			:	小梅哥
*	Target Device	:	10CL025YU256C8
*	Tool versions	:	Quartus Prime 18.1
*	Create Date		:	2021-12-20
*	Revision			:	v1.0
*	Description		:	Реализация счётчика "вверх/вниз" по нажатию кнопок с отображением на LED
**************************************************/

module led_ctrl(
			Clk,        // системный тактовый сигнал 50 МГц
			Rst_n,      // активный низкий сигнал сброса
			key_flag0,  // флаг кнопки S0 (импульс при нажатии/отпускании)
			key_flag1,  // флаг кнопки S1
			key_state0, // состояние кнопки S0 (0 — нажата, 1 — отпущена)
			key_state1, // состояние кнопки S1
			led         // 2-битный выход для светодиодов
		);

	//------------------------------------------------------------
	// 1. Объявление входов и выходов
	//------------------------------------------------------------
	input Clk;
	input Rst_n;
	input key_flag0, key_flag1;   // импульсы событий от фильтра кнопок
	input key_state0, key_state1; // текущие стабильные состояния кнопок

	output [1:0] led;             // выход на два светодиода

	//------------------------------------------------------------
	// 2. Внутренний регистр для хранения состояния светодиодов
	//------------------------------------------------------------
	reg [1:0] led_r;              // внутренний счётчик (2 бита)

	//------------------------------------------------------------
	// 3. Логика управления счётчиком
	//------------------------------------------------------------
	// При каждом стабильном нажатии S0 — увеличиваем счётчик
	// При каждом стабильном нажатии S1 — уменьшаем счётчик
	// Светодиоды отображают двоичное значение (через инверсию)
	//------------------------------------------------------------
	always@(posedge Clk or negedge Rst_n)
	if(!Rst_n)
		// При сбросе выключаем все LED
		led_r <= 2'b00;
	else if(key_flag0 && !key_state0)
		// Если S0 нажата (флаг есть, состояние = 0)
		led_r <= led_r + 1'b1;
	else if(key_flag1 && !key_state1)
		// Если S1 нажата — уменьшаем счётчик
		led_r <= led_r - 1'b1;
	else
		// Иначе оставляем прежнее значение
		led_r <= led_r;

	//------------------------------------------------------------
	// 4. Инвертируем значение для активного низкого LED
	//------------------------------------------------------------
	assign led = ~led_r;

endmodule
